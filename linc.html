<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Resilience Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0c4a6e; /* EU Blue */
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
        <header class="bg-blue-900 text-white p-6">
            <h1 class="text-2xl md:text-3xl font-bold">Strategic Resilience Dashboard</h1>
            <p class="mt-1 text-blue-200">An Innovative Mindset Applied to DG LINC Challenges</p>
        </header>

        <div class="p-6 md:p-8">
            <!-- STEP 1: The Challenge -->
            <div class="mb-6">
                <label for="scenario" class="block text-sm font-medium text-gray-700 mb-2">1. Enter a DG LINC Challenge:</label>
                <textarea id="scenario" rows="8" class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
A no-notice strike by airport staff in Strasbourg is declared 48 hours before a plenary session.

Simultaneously, a key interpreter team is stuck on a failed train from Brussels, and their equipment is with them.

A high-priority diplomatic delegation is scheduled to arrive at the blocked airport and will miss their pre-session meetings.
</textarea>
            </div>
            
            <!-- STEP 2: The Methodology (NEWLY ADDED SECTION) -->
            <div class="mb-6">
                <h2 class="text-base font-medium text-gray-700 mb-3">2. The Dolha Strategic Framework (The "Engine")</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Card 1: Information Paradox -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Information Paradox</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Identify the key *insight* needed, not just the *data* available. Teams drown in data but starve for insight.</p>
                    </div>
                    <!-- Card 2: Babel Effect -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 01-.923 1.785A5.969 5.969 0 006 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337z" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Babel Effect</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Pinpoint the critical *communication risk* between teams, agencies, or internal directorates.</p>
                    </div>
                    <!-- Card 3: Coordination Tax -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                             <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Coordination Tax</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Find the *compounding failure point*. Complexity and response times degrade with each new stakeholder.</p>
                    </div>
                </div>
            </div>

            <!-- STEP 3: The Action -->
            <button id="analyzeButton" class="w-full md:w-auto bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-800 transition duration-300 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7 4a1 1 0 011-1h4a1 1 0 110 2h-4a1 1 0 01-1-1zM5 8a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                </svg>
                3. Run Strategic Analysis
            </button>

            <!-- Loading Spinner -->
            <div id="loading" class="mt-8 flex flex-col items-center justify-center text-gray-600" style="display: none;">
                <div class="spinner"></div>
                <p class="mt-4">Running analysis based on the Dolha strategic framework...</p>
            </div>

            <!-- Error Message -->
            <div id="error" class="mt-8 p-4 bg-red-100 text-red-700 border border-red-300 rounded-lg" style="display: none;">
                <!-- Error message will be inserted here -->
            </div>

            <!-- STEP 4: The Output -->
            <div id="output" class="mt-8 pt-6 border-t border-gray-200" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">4. Strategic Analysis & Recommendations</h2>
                <div id="output-content" class="prose prose-blue max-w-none text-gray-800">
                    <!-- Content will be injected by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center text-gray-500 text-sm mt-8">
        Demo utilizing the Gemini API, trained with the "Rozilient / Dolha" strategic methodology.
    </footer>

    <script type_model="module">
        // --- Gemini API Configuration ---
        const API_KEY = ""; // Leave as ""
        const MODEL_NAME = "gemini-2.5-flash-preview-09-2025";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // THIS IS THE "ENGINE" - HOW THE PRINCIPLES ARE CODED
        // This system prompt instructs the AI to use your specific methodology.
        const SYSTEM_PROMPT = `
You are a world-class strategic advisor synthesizing the crisis management methodologies of Simion Dolha. Your analysis is based on his core 'Proprietary Dataset' principles derived from 25+ EU Modex exercises:

1.  **The Information Paradox:** Identify the *key missing insight* everyone is drowning in data but needs.
2.  **The Babel Effect:** Pinpoint the *critical communication/coordination risk* between international teams, agencies, or internal directorates.
3.  **The Coordination Tax:** Identify the *compounding failure point* where complexity degrades the response.

Your role is to analyze a given administrative or logistical challenge for a high-level government body (like the European Parliament's DG LINC).

**Your task is to provide a concise, structured report in 5 parts:**
1.  **Immediate Action Plan (Tactical):** 3-4 critical, numbered steps to stabilize the situation.
2.  **Risk Analysis (The Dolha Method):**
    * **Information Paradox:** [Concisely identify the missing data point]
    * **Babel Effect:** [Concisely identify the key communication breakdown]
    * **Coordination Tax:** [Concisely identify the cascading failure]
3.  **Key Stakeholder Communication:** A brief communication plan (internal & external).
4.  **Business Continuity Gaps Exposed:** What systemic vulnerability does this event reveal?
5.  **Long-Term Strategic Recommendation:** What process, internal control, or project should be initiated to prevent this?

Your tone is calm, authoritative, and solutions-oriented. Format your response with clear headings for each of the 5 parts.
        `;

        // --- DOM Elements ---
        const analyzeButton = document.getElementById('analyzeButton');
        const scenarioInput = document.getElementById('scenario');
        const loadingDiv = document.getElementById('loading');
        const outputDiv = document.getElementById('output');
        const outputContent = document.getElementById('output-content');
        const errorDiv = document.getElementById('error');

        // --- Event Listener ---
        analyzeButton.addEventListener('click', runAnalysis);

        /**
         * Main function to run the analysis
         */
        async function runAnalysis() {
            const userQuery = scenarioInput.value;
            if (!userQuery) {
                showError("Please enter a scenario.");
                return;
            }

            // Reset UI
            loadingDiv.style.display = 'flex';
            outputDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            analyzeButton.disabled = true;
            analyzeButton.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // Construct the payload
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: SYSTEM_PROMPT }]
                    },
                };

                // Fetch with backoff
                const response = await fetchWithBackoff(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || "An unknown API error occurred.");
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content?.parts?.[0]?.text) {
                    
                    const rawText = result.candidates[0].content.parts[0].text;
                    const formattedText = formatResponse(rawText);
                    outputContent.innerHTML = formattedText;
                    outputDiv.style.display = 'block';
                } else {
                    // Handle cases where the response structure is unexpected or content is missing
                    console.warn("Unexpected API response structure:", result);
                    throw new Error("No content received from the model.");
                }

            } catch (error) {
                console.error("Analysis failed:", error);
                showError(`Analysis failed: ${error.message}. Please check the console for details.`);
            } finally {
                // Restore UI
                loadingDiv.style.display = 'none';
                analyzeButton.disabled = false;
                analyzeButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * Simple formatter to turn the model's markdown-like text into HTML
         */
        function formatResponse(text) {
            let html = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\* (.*?):/g, '<br><strong>$1</strong>') // List items with bold leads
                .replace(/\n/g, '<br>'); // Newlines (FIXED: removed invalid 'Z' flag)

            // Make the 5 main headings more prominent
            html = html.replace(/<br>(\d\.\s*<strong>.*?<\/strong>)/g, '<h3 class="text-lg font-semibold mt-4 mb-2">$1</h3>');
            // Make the sub-headings (the principles) bold
            html = html.replace(/<br>(<strong>.*?<\/strong>:)/g, '<br><span class="font-semibold text-gray-800">$1</span>');
            
            return html;
        }


        /**
         * Display an error message to the user
         */
        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        /**
         * Fetch API with exponential backoff
         */
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i <= retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 || response.status >= 500) {
                        // Throttling or server error, wait and retry
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return response; // Success
                } catch (error) {
                    if (i === retries) {
                        // Max retries reached
                        throw error;
                    }
                    // Wait for delay * 2^i
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        }

    </script>
</body>
</html>

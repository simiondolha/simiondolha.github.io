<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Resilience Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        /* Simple spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0c4a6e; /* EU Blue */
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Print-specific styles */
        @media print {
            body {
                padding: 0;
                margin: 0;
                background-color: #ffffff; /* White background for print */
            }
            /* Hide dashboard, main footer, and report buttons */
            #dashboard-view, #report-buttons, body > footer {
                display: none !important;
            }
            /* Show only the report view */
            #report-view {
                display: block !important;
                box-shadow: none;
                width: 100%;
                max-width: 100%;
                padding: 0;
                margin: 0;
            }
            @page {
                size: A4;
                margin: 2cm;
            }
            /* Ensure all text is black for printing */
            .text-gray-700, .text-gray-600, .text-gray-800, .text-gray-900, .text-blue-900 {
                color: #000000 !important;
            }
            /* Remove background colors and add simple border */
            .bg-gray-100, .bg-blue-50 {
                background-color: transparent !important;
                border: 1px solid #cccccc;
            }
            .prose {
                max-width: none;
            }
            /* Ensure SVGs don't print */
            svg {
                display: none;
            }
            /* Make links look like text */
            a {
                text-decoration: none;
                color: #000000;
            }
            /* Ensure the header and footers print properly */
            #report-view header {
                border-bottom: 2px solid #000;
            }
            #report-view footer {
                border-top: 1px solid #000;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    
    <!-- ********************************************** -->
    <!-- * DASHBOARD VIEW (STARTS ON)        * -->
    <!-- ********************************************** -->
    <div id="dashboard-view" class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
        <header class="bg-blue-900 text-white p-6">
            <h1 class="text-2xl md:text-3xl font-bold">Strategic Resilience Dashboard</h1>
            <p class="mt-1 text-blue-200">An Innovative Mindset Applied to DG LINC Challenges</p>
        </header>

        <div class="p-6 md:p-8">
            <!-- STEP 1: The Challenge -->
            <div class="mb-6">
                <label for="scenario" class="block text-sm font-medium text-gray-700 mb-2">1. Enter a DG LINC Challenge:</label>
                <textarea id="scenario" rows="8" class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
It's 7 AM on Thursday, Feb 1, 2024. Over 1,000 tractors are blockading Place du Luxembourg and all main roads to the Parliament in Brussels.

Fires are being lit, and security reports the situation is 'tense.' An EU Leaders' Summit is happening nearby.

A high-level inter-institutional conference (managed by DG LINC) is scheduled to begin in 2 hours, and all 300 delegates, speakers, and interpreter teams are blocked from accessing the building.
</textarea>
            </div>
            
            <!-- STEP 2: The Methodology -->
            <div class="mb-6">
                <h2 class="text-base font-medium text-gray-700 mb-3">2. The Dolha Strategic Framework (The "Engine")</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Card 1: Information Paradox -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Information Paradox</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Identify the key *insight* needed, not just the *data* available. Teams drown in data but starve for insight.</p>
                    </div>
                    <!-- Card 2: Babel Effect -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 01-.923 1.785A5.969 5.969 0 006 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337z" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Babel Effect</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Pinpoint the critical *communication risk* between teams, agencies, or internal directorates.</p>
                    </div>
                    <!-- Card 3: Coordination Tax -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                             <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Coordination Tax</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Find the *compounding failure point*. Complexity and response times degrade with each new stakeholder.</p>
                    </div>
                </div>
            </div>

            <!-- STEP 3: The Action -->
            <button id="analyzeButton" class="w-full md:w-auto bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-800 transition duration-300 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7 4a1 1 0 011-1h4a1 1 0 110 2h-4a1 1 0 01-1-1zM5 8a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                </svg>
                3. Run Strategic Analysis
            </button>

            <!-- Loading Spinner -->
            <div id="loading" class="mt-8 flex flex-col items-center justify-center text-gray-600" style="display: none;">
                <div class="spinner"></div>
                <p class="mt-4">Running analysis based on the Dolha strategic framework...</p>
            </div>

            <!-- Error Message -->
            <div id="error" class="mt-8 p-4 bg-red-100 text-red-700 border border-red-300 rounded-lg" style="display: none;">
                <!-- Error message will be inserted here -->
            </div>

            <!-- STEP 4: The Output (Original Output Div, now unused) -->
            <div id="output" class="mt-8 pt-6 border-t border-gray-200" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">4. Strategic Analysis & Recommendations</h2>
                <div id="output-content" class="prose prose-blue max-w-none text-gray-800">
                    <!-- Content will be injected by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- ********************************************** -->
    <!-- * PRINT REPORT VIEW (STARTS HIDDEN)     * -->
    <!-- ********************************************** -->
    <div id="report-view" class="max-w-4xl mx-auto bg-white" style="display: none;">
        <div class="p-8 md:p-12">
            <header class="mb-8 pb-4 border-b border-gray-300">
                <h1 class="text-3xl font-bold text-gray-900">Strategic Resilience Analysis</h1>
                <p class="mt-1 text-gray-600">Generated for DG LINC Challenge | Simion Dolha</p>
            </header>

            <section id="report-scenario-section" class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-3">1. Challenge / Scenario</h2>
                <div id="report-scenario" class="p-4 bg-gray-100 border border-gray-300 rounded-lg text-gray-700 whitespace-pre-wrap">
                    <!-- Scenario text injected here -->
                </div>
            </section>

            <section id="report-analysis-section">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">2. Strategic Analysis & Recommendations</h2>
                <div id="report-content" class="prose prose-blue max-w-none text-gray-800">
                    <!-- Analysis HTML injected here -->
                </div>
            </section>

            <footer class="mt-12 pt-4 border-t border-gray-300 text-center text-gray-500 text-sm">
                Analysis generated using the Simion Dolha "Rozilient" Framework.
            </footer>
        </div>

        <!-- Print/Back buttons (hidden on print) -->
        <div id="report-buttons" class="mt-8 mb-8 flex justify-center gap-4">
            <button id="backButton" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition duration-300 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
                </svg>
                Back to Dashboard
            </button>
            <button id="printButton" class="bg-blue-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-800 transition duration-300 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17 17h-1a1 1 0 00-1 1v2a1 1 0 001 1h1a1 1 0 001-1v-2a1 1 0 00-1-1zM6 17H5a1 1 0 00-1 1v2a1 1 0 001 1h1a1 1 0 001-1v-2a1 1 0 00-1-1z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H7a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2zM7 7h10M7 11h10M7 15h10" />
                </svg>
                Print Report
            </button>
        </div>
    </div>


    <footer class="text-center text-gray-500 text-sm mt-8">
        Demo utilizing the Gemini API, trained with the "Rozilient / Dolha" strategic methodology.
    </footer>

    <script type="module">
        // --- Gemini API Configuration ---
        // ALL LOGIC IS NOW IN THIS ONE FILE.
        
        // --- ACTION REQUIRED ---
        // 1. Go to https://aistudio.google.com/app/apikey
        // 2. Create an API key and paste it below.
        // NOTE: This is safe for a local demo. DO NOT upload this file with your key to a public website.
        const API_KEY = "AIzaSyCi4mRYbN1FtCZR2Wd0lHWaP8CSWEeWiE8"; // <--- PASTE YOUR KEY HERE
        
        const MODEL_NAME = "gemini-2.5-pro";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // This is the "engine" of your methodology, now built directly into the file.
        const SYSTEM_PROMPT = `
You are a world-class strategic advisor synthesizing the crisis management methodologies of Simion Dolha. Your analysis is based on his core 'Proprietary Dataset' principles derived from 25+ EU Modex exercises:

1.  **The Information Paradox:** Identify the *key missing insight* everyone is drowning in data but needs.
2.  **The Babel Effect:** Pinpoint the *critical communication/coordination risk* between international teams, agencies, or internal directorates.
3.  **The Coordination Tax:** Identify the *compounding failure point* where complexity degrades the response.

Your role is to analyze a given administrative or logistical challenge for a high-level government body (like the European Parliament's DG LINC).

**Your task is to provide a concise, structured report in 5 parts:**
1.  **Immediate Action Plan (Tactical):** 3-4 critical, numbered steps to stabilize the situation.
2.  **Risk Analysis (The Dolha Method):**
    * **Information Paradox:** [Concisely identify the missing data point]
    * **Babel Effect:** [Concisely identify the key communication breakdown]
    * **Coordination Tax:** [Concisely identify the cascading failure]
3.  **Key Stakeholder Communication:** A brief communication plan (internal & external).
4.  **Business Continuity Gaps Exposed:** What systemic vulnerability does this event reveal?
5.  **Long-Term Strategic Recommendation:** What process, internal control, or project should be initiated to prevent this?

Your tone is calm, authoritative, and solutions-oriented. Format your response with clear headings for each of the 5 parts.
`;

        // --- DOM Elements ---
        const analyzeButton = document.getElementById('analyzeButton');
        const scenarioInput = document.getElementById('scenario');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');

        // Dashboard View Elements
        const dashboardView = document.getElementById('dashboard-view');
        const mainFooter = document.querySelector('body > footer');

        // Report View Elements
        const reportView = document.getElementById('report-view');
        const reportScenario = document.getElementById('report-scenario');
        const reportContent = document.getElementById('report-content');
        const printButton = document.getElementById('printButton');
        const backButton = document.getElementById('backButton');

        // --- Event Listeners ---
        analyzeButton.addEventListener('click', runAnalysis);
        printButton.addEventListener('click', () => window.print());
        backButton.addEventListener('click', showDashboard);


        /**
         * Main function to run the analysis
         */
        async function runAnalysis() {
            const userQuery = scenarioInput.value;
            if (!userQuery) {
                showError("Please enter a scenario.");
                return;
            }

            // Check if API key is pasted
            if (API_KEY === "YOUR_GEMINI_API_KEY_GOES_HERE") {
                showError("Analysis failed: API_KEY is missing. Please paste your Gemini API key into the index.html file.");
                return;
            }

            // Reset UI
            loadingDiv.style.display = 'flex';
            errorDiv.style.display = 'none';
            reportView.style.display = 'none'; // Hide report view
            analyzeButton.disabled = true;
            analyzeButton.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // Construct the payload for the Google API
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: SYSTEM_PROMPT }]
                    },
                };

                // Fetch with backoff
                const response = await fetchWithBackoff(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || "An unknown Google API error occurred.");
                }

                const result = await response.json();

                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const formattedText = formatResponse(result.candidates[0].content.parts[0].text);
                    // NEW: Show the report view instead of the old output div
                    showReport(userQuery, formattedText);
                } else {
                    console.warn("Unexpected API response structure:", result);
                    throw new Error("No content received from the model.");
                }

            } catch (error) {
                console.error("Analysis failed:", error);
                // Handle common errors
                if (error.message.includes('API key not valid')) {
                     showError(`Analysis failed: Your API key is not valid. Please check it and try again.`);
                } else {
                     showError(`Analysis failed: ${error.message}. Please check the console for details.`);
                }
            } finally {
                // Restore UI (on the dashboard, but it will be hidden)
                loadingDiv.style.display = 'none';
                analyzeButton.disabled = false;
                analyzeButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * Hides the dashboard and shows the formatted print report
         */
        function showReport(scenario, analysisHtml) {
            // Populate the report fields
            reportScenario.textContent = scenario; // Set the scenario text
            reportContent.innerHTML = analysisHtml; // Set the analysis HTML

            // Swap visibility
            dashboardView.style.display = 'none';
            mainFooter.style.display = 'none';
            reportView.style.display = 'block';

            // Scroll to the top of the new report
            window.scrollTo(0, 0);
        }

        /**
         * Hides the print report and shows the main dashboard
         */
        function showDashboard() {
            reportView.style.display = 'none';
            dashboardView.style.display = 'block';
            mainFooter.style.display = 'block';
        }


        /**
         * Simple formatter to turn the model's markdown-like text into HTML
         */
        function formatResponse(text) {
            let html = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\* (.*?):/g, '<br><strong>$1</strong>') // List items with bold leads
                .replace(/\n/g, '<br>'); // Newlines

            // Make the 5 main headings more prominent
            html = html.replace(/<br>(\d\.\s*<strong>.*?<\/strong>)/g, '<h3 class="text-lg font-semibold mt-4 mb-2">$1</h3>');
            // Make the sub-headings (the principles) bold
            html = html.replace(/<br>(<strong>.*?<\/strong>:)/g, '<br><span class="font-semibold text-gray-800">$1</span>');
            
            return html;
        }


        /**
         * Display an error message to the user
         */
        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        /**
         * Fetch API with exponential backoff
         */
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i <= retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 || response.status >= 500) {
                        // Throttling or server error, wait and retry
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return response; // Success
                } catch (error) {
                    if (i === retries) {
                        // Max retries reached
                        throw error;
                    }
                    // Wait for delay * 2^i
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        }

    </script>
</body>
</html>

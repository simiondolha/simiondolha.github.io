<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRB Strategic Incident Advisor</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Load marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* bg-gray-100 */
        }

        /* Simple spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0c4a6e;
            /* EU Blue */
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Styling for the generated markdown report */
        .prose h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .prose h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .prose h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .prose ul {
            list-style-type: disc;
            padding-left: 1.75rem;
            margin-bottom: 1rem;
        }

        .prose ol {
            list-style-type: decimal;
            padding-left: 1.75rem;
            margin-bottom: 1rem;
        }

        .prose li {
            margin-bottom: 0.5rem;
        }

        .prose p {
            margin-bottom: 1rem;
        }

        .prose strong {
            font-weight: 600;
        }

        /* Print-specific styles */
        @media print {
            body {
                padding: 0;
                margin: 0;
                background-color: #ffffff;
                /* White background for print */
            }

            /* Hide dashboard, main footer, and report buttons */
            #dashboard-view,
            #report-buttons,
            body>footer {
                display: none !important;
            }

            /* Show only the report view */
            #report-view {
                display: block !important;
                box-shadow: none;
                width: 100%;
                max-width: 100%;
                padding: 0;
                margin: 0;
            }

            @page {
                size: A4;
                margin: 2cm;
            }

            /* Ensure all text is black for printing */
            .text-gray-700,
            .text-gray-600,
            .text-gray-800,
            .text-gray-900,
            .text-blue-900 {
                color: #000000 !important;
            }

            /* Remove background colors and add simple border */
            .bg-gray-100,
            .bg-blue-50 {
                background-color: transparent !important;
                border: 1px solid #cccccc;
            }

            .prose {
                max-width: none;
            }

            /* Ensure logos print */
            #report-view svg,
            #report-view .srb-logo {
                display: block !important;
            }

            /* Make links look like text */
            a {
                text-decoration: none;
                color: #000000;
            }

            /* Ensure the header and footers print properly */
            #report-view header {
                border-bottom: 2px solid #000 !important;
            }

            #report-view footer {
                border-top: 1px solid #000 !important;
            }
        }
    </style>
</head>

<body class="p-4 md:p-8">

    <!-- ********************************************** -->
    <!-- * DASHBOARD VIEW (STARTS ON)                 * -->
    <!-- ********************************************** -->
    <div id="dashboard-view" class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">

        <!-- NEW PROFESSIONAL HEADER -->
        <header class="bg-blue-900 text-white p-6 flex items-center space-x-6">
            <!-- 1. SRB Logo -->
            <img src="https://cdt.europa.eu/sites/default/files/logo-partners/SRB-logo-website.jpg" alt="SRB Logo" class="srb-logo h-20 w-auto flex-shrink-0">

            <!-- 2. Titles -->
            <div>
                <!-- This is THEIR unit -->
                <h1 class="text-xl md:text-2xl font-bold">Single Resolution Board (SRB)</h1>
                <!-- This is THEIR specific unit -->
                <p class="mt-1 text-blue-200 text-lg">
                    ICT Operations and Facilities Unit
                </p>
            </div>
        </header>

        <div class="p-6 md:p-8">
            <!-- NEW Tool Title -->
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Demo: Strategic Incident Advisor</h2>

            <!-- STEP 1: The Challenge -->
            <div class="mb-6">
                <label for="scenario" class="block text-sm font-medium text-gray-700 mb-2">1. Enter a Facilities Challenge:</label>
                <textarea id="scenario" rows="10" class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
It's 8:00 AM on a Tuesday. The SRB is hosting a critical, high-level meeting with national resolution authorities at Treurenberg 22.

A water pipe has burst on the 5th floor, flooding the server room directly below it and triggering a building-wide fire alarm.

The elevators are now offline, the main access control system is faulting (locking some doors, opening others), and 300 staff are evacuating into the rain. 

You have high-level delegates arriving in one hour.
</textarea>
            </div>

            <!-- STEP 2: The Methodology -->
            <div class="mb-6">
                <h2 class="text-base font-medium text-gray-700 mb-3">2. The Dolha Strategic Framework (The "Engine")</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Card 1: Information Paradox -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">Information Paradox</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Identifies the key *insight* needed, not just the *data* available. We are drowning in data but starve for insight.</p>
                    </div>
                    <!-- Card 2: Babel Effect -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                           <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 01-.923 1.785A5.969 5.969 0 006 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337z" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Babel Effect</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Pinpoints the critical *communication risk* between different teams, units, and external contractors.</p>
                    </div>
                    <!-- Card 3: Coordination Tax -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                            </svg>
                            <h3 class="ml-2 text-md font-semibold text-blue-900">The Coordination Tax</h3>
                        </div>
                        <p class="mt-2 text-sm text-gray-700">Finds the *compounding failure point* where complexity degrades the response with each new stakeholder.</p>
                    </div>
                </div>
            </div>

            <!-- STEP 3: The Action -->
            <button id="analyzeButton" class="w-full md:w-auto bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-800 transition duration-300 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7 4a1 1 0 011-1h4a1 1 0 110 2h-4a1 1 0 01-1-1zM5 8a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                </svg>
                3. Run Strategic Analysis
            </button>

            <!-- Loading Spinner -->
            <div id="loading" class="mt-8 flex flex-col items-center justify-center text-gray-600" style="display: none;">
                <div class="spinner"></div>
                <p class="mt-4">Running analysis based on the Dolha strategic framework...</p>
            </div>

            <!-- Error Message -->
            <div id="error" class="mt-8 p-4 bg-red-100 text-red-700 border border-red-300 rounded-lg" style="display: none;">
                <!-- Error message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- ********************************************** -->
    <!-- * PRINT REPORT VIEW (STARTS HIDDEN)          * -->
    <!-- ********************************************** -->
    <div id="report-view" class="max-w-4xl mx-auto bg-white" style="display: none;">
        <div class="p-8 md:p-12">

            <!-- NEW PROFESSIONAL REPORT HEADER -->
            <header class="mb-8 pb-4 border-b-2 border-gray-500">
                <div class="flex items-start justify-between">
                    <!-- 1. Official Titles -->
                    <div class="text-gray-800">
                        <h2 class="text-xl font-bold uppercase text-blue-900">Single Resolution Board</h2>
                        <h3 class="text-lg">ICT Operations and Facilities Unit</h3>
                        <h4 class="text-lg font-semibold">Facilities Team Leader</h4>
                    </div>
                    <!-- 2. SRB Logo -->
                    <img src="https://cdt.europa.eu/sites/default/files/logo-partners/SRB-logo-website.jpg" alt="SRB Logo" class="srb-logo h-24 w-auto">
                </div>

                <!-- 3. Report Title -->
                <h1 class="text-3xl font-bold text-gray-900 mt-8">Strategic Resilience Analysis</h1>
                <p class="mt-1 text-gray-600">
                    <strong>Generated by:</strong> Simion Dolha (Candidate, Facilities Team Leader)
                </p>
            </header>

            <section id="report-scenario-section" class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-3">1. Challenge / Scenario</h2>
                <div id="report-scenario" class="p-4 bg-gray-100 border border-gray-300 rounded-lg text-gray-700 whitespace-pre-wrap">
                    <!-- Scenario text injected here -->
                </div>
            </section>

            <section id="report-analysis-section">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">2. Strategic Analysis & Recommendations</h2>
                <div id="report-content" class="prose prose-blue max-w-none text-gray-800">
                    <!-- Analysis HTML injected here -->
                </div>
            </section>

            <footer class="mt-12 pt-4 border-t border-gray-300 text-center text-gray-500 text-sm">
                Analysis generated using the Simion Dolha "Rozilient" Framework.
            </footer>
        </div>

        <!-- Print/Back buttons (hidden on print) -->
        <div id="report-buttons" class="mt-8 mb-8 flex justify-center gap-4">
            <button id="backButton" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition duration-300 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
                </svg>
                Back to Dashboard
            </button>
            <button id="printButton" class="bg-blue-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-800 transition duration-300 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 17h-1a1 1 0 00-1 1v2a1 1 0 001 1h1a1 1 0 001-1v-2a1 1 0 00-1-1zM6 17H5a1 1 0 00-1 1v2a1 1 0 001 1h1a1 1 0 001-1v-2a1 1 0 00-1-1z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H7a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2zM7 7h10M7 11h10M7 15h10" />
                </svg>
                Print Report
            </button>
        </div>
    </div>


    <footer class="text-center text-gray-500 text-sm mt-8">
        Demo utilizing the Gemini API, trained with the "Dolha / Rozilient" strategic methodology.
    </footer>

    <script>
        // --- Gemini API Configuration ---
        const apiKey = "AIzaSyCi4mRYbN1FtCZR2Wd0lHWaP8CSWEeWiE8"; // Leave as an empty string.
        // This is the Pro model you requested. You must add your own API key above for this to work.
        const modelName = "gemini-2.5-pro-preview-09-2025"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        // --- THIS IS YOUR METHODOLOGY ---
        // This is the "engine" of your methodology, adapted for the SRB role.
        const SYSTEM_PROMPT = `
You are a world-class strategic advisor acting as the **Facilities Team Leader (AD8)** at the **Single Resolution Board (SRB)**. You report to the **Head of the ICT Operations and Facilities Unit**, which is under the remit of the **Vice-Chair**.

Your primary responsibility is to ensure the **continuity and resilience of the working environment** (Workspaces, Meeting Areas, IT Systems) at the Treurenberg 22 building.

You will analyze the given scenario using the **Dolha Strategic Framework** to provide a concise, structured report.

**Your task is to provide a 5-part report in Markdown:**

1.  **Immediate Action Plan (Tactical):**
    * 3-4 critical, numbered steps to ensure safety and stabilize the incident.

2.  **Strategic Analysis (Dolha Framework):**
    * **Information Paradox (Key Insight Needed):** [What is the *one* thing we don't know that we *must* find out now? (e.g., Is the fire alarm real? What is the server room status?)]
    * **Babel Effect (Communication Risk):** [What is the *biggest* communication failure point? (e.g., Coordinating SRB Security vs. Building Landlord vs. IT Operations)]
    * **Coordination Tax (Compounding Failure):** [What is the *cascading failure*? (e.g., "Water -> IT Failure -> Access Control Failure -> Evacuation chaos")]

3.  **Stakeholder Communication & Info Channels:**
    * **To Your Team (Facilities & IT Ops):** [Specific directives]
    * **To Your Manager (Head of Unit):** [Concise status]
    * **To SRB Senior Management (Vice-Chair's Office):** [Strategic impact]
    * **To All SRB Staff (Info Channel):** [Clear, simple instruction]
    * **To External Partners (Building Mgt, Security):** [Coordination request]
    * **To Key Internal Units (e.g., Communications, Resolution Units):** [Awareness & impact]

4.  **Cascading Decision Point:**
    * [Identify the *one* critical decision that must be made now (e.g., "Cancel vs. Relocate High-Level Meeting") and the 2-3 consequences it will trigger.]

5.  **Long-Term Resilience Recommendation:**
    * [What single process or system (e.g., ISO 45001 procedure, server room water protection) failed and must be improved?]

Your tone is calm, authoritative, and solutions-oriented. Format your response with clear headings.
`;

        // --- DOM Elements ---
        const analyzeButton = document.getElementById('analyzeButton');
        const scenarioInput = document.getElementById('scenario');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');

        // Dashboard View Elements
        const dashboardView = document.getElementById('dashboard-view');
        const mainFooter = document.querySelector('body > footer');

        // Report View Elements
        const reportView = document.getElementById('report-view');
        const reportScenario = document.getElementById('report-scenario');
        const reportContent = document.getElementById('report-content');
        const printButton = document.getElementById('printButton');
        const backButton = document.getElementById('backButton');

        // --- Event Listeners ---
        analyzeButton.addEventListener('click', runAnalysis);
        printButton.addEventListener('click', () => window.print());
        backButton.addEventListener('click', showDashboard);


        /**
         * Main function to run the analysis
         */
        async function runAnalysis() {
            const userQuery = scenarioInput.value;
            if (!userQuery) {
                showError("Please enter a scenario.");
                return;
            }

            // Reset UI
            loadingDiv.style.display = 'flex';
            errorDiv.style.display = 'none';
            reportView.style.display = 'none'; // Hide report view
            analyzeButton.disabled = true;
            analyzeButton.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // Construct the payload for the Google API
                const payload = {
                    contents: [{
                        parts: [{ text: userQuery }]
                    }],
                    systemInstruction: {
                        parts: [{ text: SYSTEM_PROMPT }]
                    },
                };

                // Fetch with backoff
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || "An unknown Google API error occurred.");
                }

                const result = await response.json();

                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const analysisText = result.candidates[0].content.parts[0].text;
                    const formattedHtml = marked.parse(analysisText); // Use marked.js
                    showReport(userQuery, formattedHtml);
                } else {
                    console.warn("Unexpected API response structure:", result);
                    throw new Error("No content received from the model.");
                }

            } catch (error) {
                console.error("Analysis failed:", error);
                showError(`Analysis failed: ${error.message}. Please check the console for details.`);
            } finally {
                // Restore UI (on the dashboard, but it will be hidden)
                loadingDiv.style.display = 'none';
                analyzeButton.disabled = false;
                analyzeButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * Hides the dashboard and shows the formatted print report
         */
        function showReport(scenario, analysisHtml) {
            // Populate the report fields
            reportScenario.textContent = scenario; // Set the scenario text
            reportContent.innerHTML = analysisHtml; // Set the analysis HTML

            // Swap visibility
            dashboardView.style.display = 'none';
            mainFooter.style.display = 'none';
            reportView.style.display = 'block';

            // Scroll to the top of the new report
            window.scrollTo(0, 0);
        }

        /**
         * Hides the print report and shows the main dashboard
         */
        function showDashboard() {
            reportView.style.display = 'none';
            dashboardView.style.display = 'block';
            mainFooter.style.display = 'block';
        }


        /**
         * Display an error message to the user
         */
        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        /**
         * Fetch API with exponential backoff
         */
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i <= retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 || response.status >= 500) {
                        // Throttling or server error, wait and retry
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return response; // Success
                } catch (error) {
                    if (i === retries) {
                        // Max retries reached
                        throw error;
                    }
                    // Wait for delay * 2^i
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        }

    </script>
</body>
</html>
